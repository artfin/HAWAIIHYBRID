#ifndef DIPOLE_COAR
#define DIPOLE_COAR

#include <math.h>
#include <Eigen/Dense>

#include "angles_handler.hpp"

// i.e. θ = 0 deg  and θ = 180 deg correspond to linear CO—Ar and Ar—CO, respectively
// Dipole direction: -CO+

const double co_perm_dip = 0.0481131;

double arco_dipz_perm(double Rb, double theta);
double arco_dipx_perm(double Rb, double theta);

double arco_dipz_ind(double Rb, double theta);
double arco_dipx_ind(double Rb, double theta);

extern "C" void dipole_lab(double *q, double diplab[3]);

#ifdef DIPOLE_COAR_IMPLEMENTATION


extern "C" void dipole_lab(double *q, double diplab[3])
{
    double qmol[5];
    linear_molecule_atom_lab_to_mol(q, qmol);

    double dipmol[3];
    dipmol[0] = arco_dipx_ind(qmol[0] /* R */, qmol[4] /* Theta */);
    dipmol[1] = 0.0; 
    dipmol[2] = arco_dipz_ind(qmol[0] /* R */, qmol[4] /* Theta */);

    double sinphiem, cosphiem;
    double sinthetaem, costhetaem;
    double sinpsiem, cospsiem;

    sincos(qmol[1], &sinphiem, &cosphiem);
    sincos(qmol[2], &sinthetaem, &costhetaem);
    sincos(qmol[3], &sinpsiem, &cospsiem);

    Sz_filler(Sphiem, sinphiem, cosphiem);
    Sx_filler(Sthetaem, sinthetaem, costhetaem);
    Sz_filler(Spsiem, sinpsiem, cospsiem);
       
    Eigen::Vector3d dipmol_eig = Eigen::Map<Eigen::Vector3d>(dipmol, 3);
    Eigen::Vector3d diplab_eig = Sphiem.transpose() * Sthetaem.transpose() * Spsiem.transpose() * dipmol_eig; 
   
    diplab[0] = diplab_eig(0); 
    diplab[1] = diplab_eig(1); 
    diplab[2] = diplab_eig(2);
}

double arco_dipz_perm(double Rb, double theta)
{
    (void) Rb;
    return co_perm_dip*cos(theta);
}

double arco_dipx_perm(double Rb, double theta)
{
    (void) Rb;
    return co_perm_dip*sin(theta);
}

double arco_dipx_ind(double Rb, double theta)
{
    /* DANIIL VERSION */
    double t1,t3,t5,t7,t9,t19,t27,t35,t67,t85;
    double btoa = 0.52917725;

    double R = Rb*btoa;
    t1 = pow(R, -0.573841497201077e1);
    t3 = pow(R, -0.572853850192008e1);
    t5 = pow(R, -0.633532760785177e1);
    t7 = pow(R, -0.731722196567713e1);
    t9 = pow(R, -0.744851717506462e1);
    t19 = theta * theta;
    t27 = t19 * theta;
    t35 = t19 * t19;
    t67 = t35 * t35;
    t85 = (0.3914651489360526e6 * t1 - 0.3757692742477496e6 * t3 - 0.3434560489891386e5 * t5 + 0.1541799786123285e6 * t7 - 0.1376210827279507e6 * t9) * theta + (-0.3327645657570611e7 * t1 + 0.3180938818681510e7 * t3 + 0.3576441701165374e6 * t5 - 0.1984057269603396e7 * t7 + 0.1809309410534411e7 * t9) * t19 + (0.1187039695463881e8 * t1 - 0.1134410407482298e8 * t3 - 0.1291019338021004e7 * t5 + 0.7231193046486408e7 * t7 - 0.6598861224214474e7 * t9) * t27 + (-0.2345315815116008e8 * t1 + 0.2241850581571017e8 * t3 + 0.2524859319252107e7 * t5 - 0.1401762875124942e8 * t7 + 0.1278183268573248e8 * t9) * t35 + (0.2782645592775211e8 * t1 - 0.2660183077037873e8 * t3 - 0.2980858370790899e7 * t5 + 0.1648827356315813e8 * t7 - 0.1503218747014170e8 * t9) * t35 * theta + (-0.2092314032654059e8 * t1 + 0.2000359014949555e8 * t3 + 0.2235485408320280e7 * t5 - 0.1235837984532687e8 * t7 + 0.1126973979445547e8 * t9) * t35 * t19 + (0.1006423487035845e8 * t1 - 0.9622753038972298e7 * t3 - 0.1071506059818677e7 * t5 + 0.5920654977284260e7 * t7 - 0.5400839064937978e7 * t9) * t35 * t27 + (-0.2980823051306279e7 * t1 + 0.2850383855815557e7 * t3 + 0.3158785856549806e6 * t5 - 0.1743372275110790e7 * t7 + 0.1590756564122738e7 * t9) * t67 + (0.4914163742685439e6 * t1 - 0.4699670638625512e6 * t3 - 0.5181740332909740e5 * t5 + 0.2855634197383908e6 * t7 - 0.2606281175997284e6 * t9) * t67 * theta + (-0.3432045391748023e5 * t1 + 0.3282590198795711e5 * t3 + 0.3602448110726847e4 * t5 - 0.1982587438063416e5 * t7 + 0.1809880676047900e5 * t9) * t67 * t19;
    return t85;
    
/*
    double t1,t3,t5,t7,t9,t19,t27,t35,t67,t43,t51,t59,t75,t86,t88,t90,t92,t94,t96,t161,t162,t164;
    double btoa = 0.52917725;

    double R = Rb*btoa;
    t1 = pow(R, -0.573841497201077e1);
    t3 = pow(R, -0.572853850192008e1);
    t5 = pow(R, -0.633532760785177e1);
    t7 = pow(R, -0.731722196567713e1);
    t9 = pow(R, -0.744851717506462e1);
    t19 = theta * theta;
    t27 = t19 * theta;
    t35 = t19 * t19;
    t43 = t35 * theta;
    t51 = t35 * t19;
    t59 = t35 * t27;
    t67 = t35 * t35;
    t75 = t67 * theta;
    t86 = sin(theta);
    t88 = pow(R, -0.502653808887296e1);
    t90 = pow(R, -0.588733908149950e1);
    t92 = pow(R, -0.613019974688066e1);
    t94 = pow(R, -0.635669176351528e1);
    t96 = pow(R, -0.703447270380411e1);
    t161 = (-0.9941043306078220e3 * t88 + 0.8580941045171990e5 * t90 - 0.2576348136460623e6 * t92 + 0.2107979086691012e6 * t94 - 0.4163598071294277e5 * t96) * theta + (0.7917065832106147e4 * t88 - 0.6651280973670493e6 * t90 + 0.1990373026795342e7 * t92 - 0.1625371169688850e7 * t94 + 0.3210203330259189e6 * t96) * t19 + (-0.2496105021898234e5 * t88 + 0.2167853161830885e7 * t90 - 0.6514616982453885e7 * t92 + 0.5333508295979238e7 * t94 - 0.1054034737143140e7 * t96) * t27 + (0.3945055231106042e5 * t88 - 0.3440903199821432e7 * t90 + 0.1034386307941244e8 * t92 - 0.8469362832189966e7 * t94 + 0.1671580239963155e7 * t96) * t35 + (-0.3497951945117139e5 * t88 + 0.3034883169232765e7 * t90 - 0.9116573169668684e7 * t92 + 0.7461472442371431e7 * t94 - 0.1472328964121724e7 * t96) * t43 + (0.1802471421043111e5 * t88 - 0.1556779790425235e7 * t90 + 0.4674729898229002e7 * t92 - 0.3826418554521038e7 * t94 + 0.7567980584409047e6 * t96) * t51 + (-0.5326946961430642e4 * t88 + 0.4597094612292759e6 * t90 - 0.1381076851970454e7 * t92 + 0.1131510451689007e7 * t94 - 0.2249820541480554e6 * t96) * t59 + (0.8344257528807575e3 * t88 - 0.7224244167351586e5 * t90 + 0.2173409826007950e6 * t92 - 0.1783947425604677e6 * t94 + 0.3576749523837118e5 * t96) * t67 + (-0.5353983066240093e2 * t88 + 0.4667934939561625e4 * t90 - 0.1407693946553790e5 * t92 + 0.1158659340640586e5 * t94 - 0.2349650907498580e4 * t96) * t75 + 0.1878852131236623e3 * t88 - 0.2381710889397638e5 * t90 + 0.7449436865822642e5 * t92 - 0.6247324270023730e5 * t94 + 0.1250151510136654e5 * t96;
    t162 = cos(theta);
    t164 = ((0.3914651489360526e6 * t1 - 0.3757692742477496e6 * t3 - 0.3434560489891386e5 * t5 + 0.1541799786123285e6 * t7 - 0.1376210827279507e6 * t9) * theta + (-0.3327645657570611e7 * t1 + 0.3180938818681510e7 * t3 + 0.3576441701165374e6 * t5 - 0.1984057269603396e7 * t7 + 0.1809309410534411e7 * t9) * t19 + (0.1187039695463881e8 * t1 - 0.1134410407482298e8 * t3 - 0.1291019338021004e7 * t5 + 0.7231193046486408e7 * t7 - 0.6598861224214474e7 * t9) * t27 + (-0.2345315815116008e8 * t1 + 0.2241850581571017e8 * t3 + 0.2524859319252107e7 * t5 - 0.1401762875124942e8 * t7 + 0.1278183268573248e8 * t9) * t35 + (0.2782645592775211e8 * t1 - 0.2660183077037873e8 * t3 - 0.2980858370790899e7 * t5 + 0.1648827356315813e8 * t7 - 0.1503218747014170e8 * t9) * t43 + (-0.2092314032654059e8 * t1 + 0.2000359014949555e8 * t3 + 0.2235485408320280e7 * t5 - 0.1235837984532687e8 * t7 + 0.1126973979445547e8 * t9) * t51 + (0.1006423487035845e8 * t1 - 0.9622753038972298e7 * t3 - 0.1071506059818677e7 * t5 + 0.5920654977284260e7 * t7 - 0.5400839064937978e7 * t9) * t59 + (-0.2980823051306279e7 * t1 + 0.2850383855815557e7 * t3 + 0.3158785856549806e6 * t5 - 0.1743372275110790e7 * t7 + 0.1590756564122738e7 * t9) * t67 + (0.4914163742685439e6 * t1 - 0.4699670638625512e6 * t3 - 0.5181740332909740e5 * t5 + 0.2855634197383908e6 * t7 - 0.2606281175997284e6 * t9) * t75 + (-0.3432045391748023e5 * t1 + 0.3282590198795711e5 * t3 + 0.3602448110726847e4 * t5 - 0.1982587438063416e5 * t7 + 0.1809880676047900e5 * t9) * t67 * t19) * t86 - t161 * t162;

    return t164;
*/
}

double arco_dipz_ind(double Rb, double theta)
{
    double t1,t3,t5,t7,t9,t19,t27,t35,t67,t82;
    double btoa = 0.52917725;

    double R = Rb*btoa;
    t1 = pow(R, -0.502653808887296e1);
    t3 = pow(R, -0.588733908149950e1);
    t5 = pow(R, -0.613019974688066e1);
    t7 = pow(R, -0.635669176351528e1);
    t9 = pow(R, -0.703447270380411e1);
    t19 = theta * theta;
    t27 = t19 * theta;
    t35 = t19 * t19;
    t67 = t35 * t35;
    t82 = (-0.9941043306078220e3 * t1 + 0.8580941045171990e5 * t3 - 0.2576348136460623e6 * t5 + 0.2107979086691012e6 * t7 - 0.4163598071294277e5 * t9) * theta + (0.7917065832106147e4 * t1 - 0.6651280973670493e6 * t3 + 0.1990373026795342e7 * t5 - 0.1625371169688850e7 * t7 + 0.3210203330259189e6 * t9) * t19 + (-0.2496105021898234e5 * t1 + 0.2167853161830885e7 * t3 - 0.6514616982453885e7 * t5 + 0.5333508295979238e7 * t7 - 0.1054034737143140e7 * t9) * t27 + (0.3945055231106042e5 * t1 - 0.3440903199821432e7 * t3 + 0.1034386307941244e8 * t5 - 0.8469362832189966e7 * t7 + 0.1671580239963155e7 * t9) * t35 + (-0.3497951945117139e5 * t1 + 0.3034883169232765e7 * t3 - 0.9116573169668684e7 * t5 + 0.7461472442371431e7 * t7 - 0.1472328964121724e7 * t9) * t35 * theta + (0.1802471421043111e5 * t1 - 0.1556779790425235e7 * t3 + 0.4674729898229002e7 * t5 - 0.3826418554521038e7 * t7 + 0.7567980584409047e6 * t9) * t35 * t19 + (-0.5326946961430642e4 * t1 + 0.4597094612292759e6 * t3 - 0.1381076851970454e7 * t5 + 0.1131510451689007e7 * t7 - 0.2249820541480554e6 * t9) * t35 * t27 + (0.8344257528807575e3 * t1 - 0.7224244167351586e5 * t3 + 0.2173409826007950e6 * t5 - 0.1783947425604677e6 * t7 + 0.3576749523837118e5 * t9) * t67 + (-0.5353983066240093e2 * t1 + 0.4667934939561625e4 * t3 - 0.1407693946553790e5 * t5 + 0.1158659340640586e5 * t7 - 0.2349650907498580e4 * t9) * t67 * theta + 0.1878852131236623e3 * t1 - 0.2381710889397638e5 * t3 + 0.7449436865822642e5 * t5 - 0.6247324270023730e5 * t7 + 0.1250151510136654e5 * t9;

    return t82;

/*
    double t1,t3,t5,t7,t9,t19,t27,t35,t43,t51,t59,t67,t75,t86,t88,t90,t92,t94,t96,t161,t162,t164;
    double btoa = 0.52917725;

    double R = Rb*btoa;
    t1 = pow(R, -0.573841497201077e1);
    t3 = pow(R, -0.572853850192008e1);
    t5 = pow(R, -0.633532760785177e1);
    t7 = pow(R, -0.731722196567713e1);
    t9 = pow(R, -0.744851717506462e1);
    t19 = theta * theta;
    t27 = t19 * theta;
    t35 = t19 * t19;
    t43 = t35 * theta;
    t51 = t35 * t19;
    t59 = t35 * t27;
    t67 = t35 * t35;
    t75 = t67 * theta;
    t86 = cos(theta);
    t88 = pow(R, -0.502653808887296e1);
    t90 = pow(R, -0.588733908149950e1);
    t92 = pow(R, -0.613019974688066e1);
    t94 = pow(R, -0.635669176351528e1);
    t96 = pow(R, -0.703447270380411e1);
    t161 = (-0.9941043306078220e3 * t88 + 0.8580941045171990e5 * t90 - 0.2576348136460623e6 * t92 + 0.2107979086691012e6 * t94 - 0.4163598071294277e5 * t96) * theta + (0.7917065832106147e4 * t88 - 0.6651280973670493e6 * t90 + 0.1990373026795342e7 * t92 - 0.1625371169688850e7 * t94 + 0.3210203330259189e6 * t96) * t19 + (-0.2496105021898234e5 * t88 + 0.2167853161830885e7 * t90 - 0.6514616982453885e7 * t92 + 0.5333508295979238e7 * t94 - 0.1054034737143140e7 * t96) * t27 + (0.3945055231106042e5 * t88 - 0.3440903199821432e7 * t90 + 0.1034386307941244e8 * t92 - 0.8469362832189966e7 * t94 + 0.1671580239963155e7 * t96) * t35 + (-0.3497951945117139e5 * t88 + 0.3034883169232765e7 * t90 - 0.9116573169668684e7 * t92 + 0.7461472442371431e7 * t94 - 0.1472328964121724e7 * t96) * t43 + (0.1802471421043111e5 * t88 - 0.1556779790425235e7 * t90 + 0.4674729898229002e7 * t92 - 0.3826418554521038e7 * t94 + 0.7567980584409047e6 * t96) * t51 + (-0.5326946961430642e4 * t88 + 0.4597094612292759e6 * t90 - 0.1381076851970454e7 * t92 + 0.1131510451689007e7 * t94 - 0.2249820541480554e6 * t96) * t59 + (0.8344257528807575e3 * t88 - 0.7224244167351586e5 * t90 + 0.2173409826007950e6 * t92 - 0.1783947425604677e6 * t94 + 0.3576749523837118e5 * t96) * t67 + (-0.5353983066240093e2 * t88 + 0.4667934939561625e4 * t90 - 0.1407693946553790e5 * t92 + 0.1158659340640586e5 * t94 - 0.2349650907498580e4 * t96) * t75 + 0.1878852131236623e3 * t88 - 0.2381710889397638e5 * t90 + 0.7449436865822642e5 * t92 - 0.6247324270023730e5 * t94 + 0.1250151510136654e5 * t96;
    t162 = sin(theta);
    t164 = ((0.3914651489360526e6 * t1 - 0.3757692742477496e6 * t3 - 0.3434560489891386e5 * t5 + 0.1541799786123285e6 * t7 - 0.1376210827279507e6 * t9) * theta + (-0.3327645657570611e7 * t1 + 0.3180938818681510e7 * t3 + 0.3576441701165374e6 * t5 - 0.1984057269603396e7 * t7 + 0.1809309410534411e7 * t9) * t19 + (0.1187039695463881e8 * t1 - 0.1134410407482298e8 * t3 - 0.1291019338021004e7 * t5 + 0.7231193046486408e7 * t7 - 0.6598861224214474e7 * t9) * t27 + (-0.2345315815116008e8 * t1 + 0.2241850581571017e8 * t3 + 0.2524859319252107e7 * t5 - 0.1401762875124942e8 * t7 + 0.1278183268573248e8 * t9) * t35 + (0.2782645592775211e8 * t1 - 0.2660183077037873e8 * t3 - 0.2980858370790899e7 * t5 + 0.1648827356315813e8 * t7 - 0.1503218747014170e8 * t9) * t43 + (-0.2092314032654059e8 * t1 + 0.2000359014949555e8 * t3 + 0.2235485408320280e7 * t5 - 0.1235837984532687e8 * t7 + 0.1126973979445547e8 * t9) * t51 + (0.1006423487035845e8 * t1 - 0.9622753038972298e7 * t3 - 0.1071506059818677e7 * t5 + 0.5920654977284260e7 * t7 - 0.5400839064937978e7 * t9) * t59 + (-0.2980823051306279e7 * t1 + 0.2850383855815557e7 * t3 + 0.3158785856549806e6 * t5 - 0.1743372275110790e7 * t7 + 0.1590756564122738e7 * t9) * t67 + (0.4914163742685439e6 * t1 - 0.4699670638625512e6 * t3 - 0.5181740332909740e5 * t5 + 0.2855634197383908e6 * t7 - 0.2606281175997284e6 * t9) * t75 + (-0.3432045391748023e5 * t1 + 0.3282590198795711e5 * t3 + 0.3602448110726847e4 * t5 - 0.1982587438063416e5 * t7 + 0.1809880676047900e5 * t9) * t67 * t19) * t86 + t161 * t162;

    return t164;
*/
}



#endif // DIPOLE_COAR_IMPLEMENTATION
#endif // DIPOLE_COAR
